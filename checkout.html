<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout | Gadrel Collection</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-dark: #442c27;
      --gold: #e2be53;
      --white: #ffffff;
      --cream: #fff8e7;
      --success: #4CAF50;
      --error: #e53935;
      --shadow-sm: 0 2px 10px rgba(68, 44, 39, 0.08);
      --shadow-md: 0 8px 30px rgba(68, 44, 39, 0.12);
      --shadow-lg: 0 15px 50px rgba(68, 44, 39, 0.18);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      color: var(--primary-dark);
      background: var(--cream);
      padding-top: 80px;
      overflow-x: hidden;
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      background: rgba(68, 44, 39, 0.98);
      backdrop-filter: blur(15px);
      box-shadow: 0 4px 30px rgba(68, 44, 39, 0.1);
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 50px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .logo {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--gold);
      letter-spacing: 3px;
      text-decoration: none;
    }

    .checkout-steps {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--cream);
      font-size: 0.9rem;
    }

    .step-number {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(226, 190, 83, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .step.active .step-number {
      background: var(--gold);
      color: var(--primary-dark);
    }

    .step.completed .step-number {
      background: var(--success);
      color: white;
    }

    /* Main Container */
    .checkout-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px 80px;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 40px;
    }

    /* Forms Section */
    .checkout-forms {
      background: var(--white);
      border-radius: 20px;
      padding: 40px;
      box-shadow: var(--shadow-md);
    }

    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      color: var(--primary-dark);
      margin-bottom: 10px;
    }

    .section-subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }

    .form-section {
      margin-bottom: 40px;
    }

    .form-section h3 {
      font-size: 1.3rem;
      color: var(--primary-dark);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-section h3 i {
      color: var(--gold);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--primary-dark);
      font-size: 0.9rem;
    }

    .form-label .required {
      color: var(--error);
      margin-left: 3px;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: var(--white);
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(226, 190, 83, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Payment Methods */
    .payment-methods {
      display: grid;
      gap: 15px;
    }

    .payment-option {
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .payment-option:hover {
      border-color: var(--gold);
      background: rgba(226, 190, 83, 0.05);
    }

    .payment-option.selected {
      border-color: var(--gold);
      background: rgba(226, 190, 83, 0.1);
    }

    .payment-radio {
      width: 20px;
      height: 20px;
      border: 2px solid #ccc;
      border-radius: 50%;
      position: relative;
      transition: all 0.3s ease;
    }

    .payment-option.selected .payment-radio {
      border-color: var(--gold);
    }

    .payment-option.selected .payment-radio::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--gold);
    }

    .payment-icon {
      font-size: 2rem;
      color: var(--primary-dark);
    }

    .payment-info h4 {
      font-size: 1rem;
      color: var(--primary-dark);
      margin-bottom: 3px;
    }

    .payment-info p {
      font-size: 0.85rem;
      color: #666;
    }

    /* Payment Details */
    .payment-details {
      margin-top: 20px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 12px;
      border-left: 4px solid var(--gold);
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .payment-details h4 {
      color: var(--primary-dark);
      margin-bottom: 15px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .payment-details p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .payment-features,
    .cod-features {
      display: grid;
      gap: 12px;
      margin-top: 15px;
    }

    .payment-features .feature,
    .cod-features .feature {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      background: white;
      border-radius: 8px;
    }

    .payment-features .feature i,
    .cod-features .feature i {
      color: var(--gold);
      font-size: 1.2rem;
    }

    .bank-info-preview {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .bank-info-preview .info-item {
      padding: 10px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .bank-info-preview .info-item:last-child {
      border-bottom: none;
    }

    .bank-info-preview strong {
      color: var(--primary-dark);
      margin-right: 10px;
    }

    /* Order Summary */
    .order-summary {
      background: var(--white);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--shadow-md);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .summary-title {
      font-size: 1.5rem;
      color: var(--primary-dark);
      margin-bottom: 25px;
      font-weight: 700;
    }

    .summary-items {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
    }

    .summary-item {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #f0f0f0;
    }

    .summary-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .item-image {
      width: 70px;
      height: 70px;
      border-radius: 10px;
      object-fit: cover;
    }

    .item-details {
      flex: 1;
    }

    .item-name {
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 5px;
      font-size: 0.95rem;
    }

    .item-quantity {
      color: #666;
      font-size: 0.85rem;
      margin-bottom: 5px;
    }

    .item-price {
      color: var(--gold);
      font-weight: 700;
      font-size: 1rem;
    }

    .summary-totals {
      border-top: 2px solid #f0f0f0;
      padding-top: 20px;
      margin-bottom: 25px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 0.95rem;
    }

    .summary-row.total {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary-dark);
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px solid var(--gold);
    }

    .summary-row.total .amount {
      color: var(--gold);
    }

    /* Buttons */
    .btn-place-order {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #e2be53, #d4a949);
      color: var(--primary-dark);
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .btn-place-order:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(226, 190, 83, 0.4);
    }

    .btn-place-order:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Spinner Animation */
    .spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 3px solid rgba(68, 44, 39, 0.3);
      border-top-color: var(--primary-dark);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .btn-back {
      width: 100%;
      padding: 14px;
      background: transparent;
      color: var(--primary-dark);
      border: 2px solid var(--primary-dark);
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-back:hover {
      background: var(--primary-dark);
      color: var(--white);
    }

    /* Trust Badges */
    .trust-badges {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #f0f0f0;
    }

    .trust-badge {
      text-align: center;
      padding: 10px;
    }

    .trust-badge i {
      font-size: 1.5rem;
      color: var(--gold);
      margin-bottom: 5px;
    }

    .trust-badge p {
      font-size: 0.7rem;
      color: #666;
    }

    /* Empty State */
    .empty-cart {
      text-align: center;
      padding: 80px 20px;
      background: var(--white);
      border-radius: 20px;
      box-shadow: var(--shadow-md);
      grid-column: 1 / -1;
    }

    .empty-cart i {
      font-size: 5rem;
      color: var(--gold);
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-cart h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      color: var(--primary-dark);
      margin-bottom: 15px;
    }

    .empty-cart p {
      color: #666;
      margin-bottom: 30px;
    }

    .btn-shop {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 15px 35px;
      background: linear-gradient(135deg, #e2be53, #d4a949);
      color: var(--primary-dark);
      text-decoration: none;
      border-radius: 12px;
      font-weight: 700;
      transition: all 0.3s ease;
    }

    .btn-shop:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(226, 190, 83, 0.4);
    }

    /* Loading Spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(68, 44, 39, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-dark);
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 968px) {
      .checkout-container {
        grid-template-columns: 1fr;
      }

      .order-summary {
        position: static;
      }

      .checkout-steps {
        display: none;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .trust-badges {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      nav {
        padding: 15px 20px;
      }

      .logo {
        font-size: 1.5rem;
      }

      .checkout-forms {
        padding: 25px;
      }

      .section-title {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <nav>
      <a href="index.html" class="logo">GADREL</a>
      
      <div class="checkout-steps">
        <div class="step completed">
          <div class="step-number">1</div>
          <span>Cart</span>
        </div>
        <div class="step active">
          <div class="step-number">2</div>
          <span>Checkout</span>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <span>Complete</span>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main Container -->
  <div class="checkout-container" id="checkoutContainer">
    <!-- This will be populated by JavaScript -->
  </div>

  <script>
    // Initialize variables
    let cart = JSON.parse(localStorage.getItem('gadrelCart')) || [];
    let currentUser = JSON.parse(localStorage.getItem('gadrelCurrentUser'));

    // Check authentication on page load
    window.addEventListener('load', () => {
      if (!currentUser) {
        // User not logged in, redirect to auth page
        localStorage.setItem('gadrelRedirectAfterLogin', 'checkout.html');
        window.location.href = 'auth.html';
        return;
      }

      if (cart.length === 0) {
        showEmptyCart();
      } else {
        renderCheckout();
      }
    });

    // Show empty cart state
    function showEmptyCart() {
      const container = document.getElementById('checkoutContainer');
      container.innerHTML = `
        <div class="empty-cart">
          <i class="fas fa-shopping-cart"></i>
          <h2>Your cart is empty</h2>
          <p>Add some items to your cart before checking out</p>
          <a href="shop.html" class="btn-shop">
            <i class="fas fa-shopping-bag"></i> Continue Shopping
          </a>
        </div>
      `;
    }

    // Render checkout form
    function renderCheckout() {
      const container = document.getElementById('checkoutContainer');
      
      // Pre-fill user data
      const userData = {
        fullName: currentUser.name || '',
        email: currentUser.email || '',
        phone: currentUser.phone || ''
      };

      container.innerHTML = `
        <!-- Forms Section -->
        <div class="checkout-forms">
          <h1 class="section-title">Checkout</h1>
          <p class="section-subtitle">Complete your order by filling in the details below</p>

          <!-- Shipping Information -->
          <div class="form-section">
            <h3><i class="fas fa-shipping-fast"></i> Shipping Information</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Full Name<span class="required">*</span></label>
                <input type="text" class="form-input" id="fullName" value="${userData.fullName}" required>
              </div>

              <div class="form-group">
                <label class="form-label">Phone Number<span class="required">*</span></label>
                <input type="tel" class="form-input" id="phone" value="${userData.phone}" required>
              </div>

              <div class="form-group full-width">
                <label class="form-label">Email Address<span class="required">*</span></label>
                <input type="email" class="form-input" id="email" value="${userData.email}" required>
              </div>

              <div class="form-group full-width">
                <label class="form-label">Street Address<span class="required">*</span></label>
                <input type="text" class="form-input" id="address" placeholder="House number and street name" required>
              </div>

              <div class="form-group">
                <label class="form-label">City<span class="required">*</span></label>
                <input type="text" class="form-input" id="city" required>
              </div>

              <div class="form-group">
                <label class="form-label">State<span class="required">*</span></label>
                <select class="form-select" id="state" required>
                  <option value="">Select State</option>
                  <option value="Abia">Abia</option>
                  <option value="Adamawa">Adamawa</option>
                  <option value="Akwa Ibom">Akwa Ibom</option>
                  <option value="Anambra">Anambra</option>
                  <option value="Bauchi">Bauchi</option>
                  <option value="Bayelsa">Bayelsa</option>
                  <option value="Benue">Benue</option>
                  <option value="Borno">Borno</option>
                  <option value="Cross River">Cross River</option>
                  <option value="Delta">Delta</option>
                  <option value="Ebonyi">Ebonyi</option>
                  <option value="Edo">Edo</option>
                  <option value="Ekiti">Ekiti</option>
                  <option value="Enugu">Enugu</option>
                  <option value="FCT">Federal Capital Territory</option>
                  <option value="Gombe">Gombe</option>
                  <option value="Imo">Imo</option>
                  <option value="Jigawa">Jigawa</option>
                  <option value="Kaduna">Kaduna</option>
                  <option value="Kano">Kano</option>
                  <option value="Katsina">Katsina</option>
                  <option value="Kebbi">Kebbi</option>
                  <option value="Kogi">Kogi</option>
                  <option value="Kwara">Kwara</option>
                  <option value="Lagos">Lagos</option>
                  <option value="Nasarawa">Nasarawa</option>
                  <option value="Niger">Niger</option>
                  <option value="Ogun">Ogun</option>
                  <option value="Ondo">Ondo</option>
                  <option value="Osun">Osun</option>
                  <option value="Oyo">Oyo</option>
                  <option value="Plateau">Plateau</option>
                  <option value="Rivers">Rivers</option>
                  <option value="Sokoto">Sokoto</option>
                  <option value="Taraba">Taraba</option>
                  <option value="Yobe">Yobe</option>
                  <option value="Zamfara">Zamfara</option>
                </select>
              </div>

              <div class="form-group full-width">
                <label class="form-label">Additional Notes (Optional)</label>
                <textarea class="form-textarea" id="notes" placeholder="Delivery instructions, special requests, etc."></textarea>
              </div>
            </div>
          </div>

          <!-- Payment Method -->
          <div class="form-section">
            <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
            
            <div class="payment-methods">
              <div class="payment-option" data-payment="bank" onclick="selectPayment('bank')">
                <div class="payment-radio"></div>
                <i class="fas fa-university payment-icon"></i>
                <div class="payment-info">
                  <h4>Bank Transfer</h4>
                  <p>Pay directly to our bank account</p>
                </div>
              </div>

              <div class="payment-option" data-payment="card" onclick="selectPayment('card')">
                <div class="payment-radio"></div>
                <i class="fas fa-credit-card payment-icon"></i>
                <div class="payment-info">
                  <h4>Card Payment</h4>
                  <p>Pay with your debit or credit card</p>
                </div>
              </div>

              <div class="payment-option selected" data-payment="delivery" onclick="selectPayment('delivery')">
                <div class="payment-radio"></div>
                <i class="fas fa-money-bill-wave payment-icon"></i>
                <div class="payment-info">
                  <h4>Cash on Delivery</h4>
                  <p>Pay when you receive your order</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <h3 class="summary-title">Order Summary</h3>
          
          <div class="summary-items" id="summaryItems">
            ${renderSummaryItems()}
          </div>

          <div class="summary-totals">
            <div class="summary-row">
              <span>Subtotal</span>
              <span id="subtotal">₦${calculateSubtotal().toLocaleString()}</span>
            </div>
            <div class="summary-row">
              <span>Shipping</span>
              <span id="shipping">₦${calculateShipping().toLocaleString()}</span>
            </div>
            <div class="summary-row total">
              <span>Total</span>
              <span class="amount" id="total">₦${calculateTotal().toLocaleString()}</span>
            </div>
          </div>

          <button class="btn-place-order" onclick="placeOrder()">
            <i class="fas fa-check-circle"></i> Place Order
          </button>

          <a href="cart.html" class="btn-back">
            <i class="fas fa-arrow-left"></i> Back to Cart
          </a>

          <div class="trust-badges">
            <div class="trust-badge">
              <i class="fas fa-lock"></i>
              <p>Secure Checkout</p>
            </div>
            <div class="trust-badge">
              <i class="fas fa-shipping-fast"></i>
              <p>Fast Delivery</p>
            </div>
            <div class="trust-badge">
              <i class="fas fa-shield-alt"></i>
              <p>Buyer Protection</p>
            </div>
          </div>
        </div>
      `;

      // Set default payment method
      selectedPaymentMethod = 'delivery';
    }

    // Render summary items
    function renderSummaryItems() {
      return cart.map(item => `
        <div class="summary-item">
          <img src="${item.image || 'https://via.placeholder.com/70'}" alt="${item.name}" class="item-image">
          <div class="item-details">
            <div class="item-name">${item.name}</div>
            <div class="item-quantity">Quantity: ${item.quantity}</div>
            <div class="item-price">₦${(item.price * item.quantity).toLocaleString()}</div>
          </div>
        </div>
      `).join('');
    }

    // Calculate subtotal
    function calculateSubtotal() {
      return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    }

    // Calculate shipping
    function calculateShipping() {
      const subtotal = calculateSubtotal();
      // Free shipping for orders over ₦50,000
      return subtotal >= 50000 ? 0 : 2500;
    }

    // Calculate total
    function calculateTotal() {
      return calculateSubtotal() + calculateShipping();
    }

    // Select payment method
    let selectedPaymentMethod = 'delivery';
    
    function selectPayment(method) {
      console.log('Payment method selected:', method);
      selectedPaymentMethod = method;
      
      // Update UI
      document.querySelectorAll('.payment-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      const selectedOption = document.querySelector(`[data-payment="${method}"]`);
      if (selectedOption) {
        selectedOption.classList.add('selected');
      }
      
      // Show payment details if needed
      showPaymentDetails(method);
      
      // Update button text based on payment method
      updateCheckoutButton(method);
    }

    // Show payment details
    function showPaymentDetails(method) {
      // Remove existing details
      const existingDetails = document.querySelector('.payment-details');
      if (existingDetails) {
        existingDetails.remove();
      }

      const paymentMethods = document.querySelector('.payment-methods');
      if (!paymentMethods) return;

      let detailsHTML = '';

      switch(method) {
        case 'card':
          detailsHTML = `
            <div class="payment-details card-details">
              <h4><i class="fas fa-info-circle"></i> Card Payment Information</h4>
              <p>You will be redirected to our secure payment gateway to complete your transaction.</p>
              <div class="payment-features">
                <div class="feature">
                  <i class="fas fa-shield-alt"></i>
                  <span>Secure SSL encryption</span>
                </div>
                <div class="feature">
                  <i class="fas fa-credit-card"></i>
                  <span>All major cards accepted</span>
                </div>
                <div class="feature">
                  <i class="fas fa-lock"></i>
                  <span>PCI DSS compliant</span>
                </div>
              </div>
            </div>
          `;
          break;
        
        case 'bank':
          detailsHTML = `
            <div class="payment-details bank-details">
              <h4><i class="fas fa-info-circle"></i> Bank Transfer Instructions</h4>
              <p>After placing your order, you will receive our bank account details to complete the transfer.</p>
              <div class="bank-info-preview">
                <div class="info-item">
                  <strong>Bank Name:</strong> Gadrel Collection Bank
                </div>
                <div class="info-item">
                  <strong>Account Number:</strong> 1234567890
                </div>
                <div class="info-item">
                  <strong>Account Name:</strong> Gadrel Collection Ltd
                </div>
              </div>
              <p style="color: #ff9800; margin-top: 15px;">
                <i class="fas fa-exclamation-triangle"></i>
                Please transfer within 24 hours to avoid order cancellation.
              </p>
            </div>
          `;
          break;
        
        case 'delivery':
          detailsHTML = `
            <div class="payment-details cod-details">
              <h4><i class="fas fa-info-circle"></i> Cash on Delivery</h4>
              <p>Pay with cash when your order is delivered to your doorstep.</p>
              <div class="cod-features">
                <div class="feature">
                  <i class="fas fa-check-circle"></i>
                  <span>No upfront payment needed</span>
                </div>
                <div class="feature">
                  <i class="fas fa-hand-holding-usd"></i>
                  <span>Pay only when you receive</span>
                </div>
                <div class="feature">
                  <i class="fas fa-box-open"></i>
                  <span>Inspect before paying</span>
                </div>
              </div>
            </div>
          `;
          break;
      }

      if (detailsHTML) {
        paymentMethods.insertAdjacentHTML('afterend', detailsHTML);
      }
    }

    // Update checkout button based on payment method
    function updateCheckoutButton(method) {
      const btn = document.querySelector('.btn-place-order');
      if (!btn) return;

      const buttonTexts = {
        'card': '<i class="fas fa-credit-card"></i> Proceed to Payment',
        'bank': '<i class="fas fa-university"></i> Complete Order',
        'delivery': '<i class="fas fa-check-circle"></i> Place Order'
      };

      btn.innerHTML = buttonTexts[method] || '<i class="fas fa-check-circle"></i> Place Order';
    }

    // Validate form
    function validateForm() {
      const fullName = document.getElementById('fullName').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const email = document.getElementById('email').value.trim();
      const address = document.getElementById('address').value.trim();
      const city = document.getElementById('city').value.trim();
      const state = document.getElementById('state').value;

      if (!fullName || !phone || !email || !address || !city || !state) {
        showNotification('Please fill in all required fields', 'error');
        return false;
      }

      // Validate email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showNotification('Please enter a valid email address', 'error');
        return false;
      }

      // Validate phone
      if (phone.replace(/\D/g, '').length < 10) {
        showNotification('Please enter a valid phone number', 'error');
        return false;
      }

      return true;
    }

    // Place order
    function placeOrder() {
      console.log('Place order called');
      console.log('Selected payment method:', selectedPaymentMethod);
      
      if (!validateForm()) {
        return;
      }

      // Validate payment method is selected
      if (!selectedPaymentMethod) {
        showNotification('Please select a payment method', 'error');
        return;
      }

      const btn = document.querySelector('.btn-place-order');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Processing Payment...';

      // Get form data
      const orderData = {
        id: Date.now(),
        customerId: currentUser.id,
        customerName: document.getElementById('fullName').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        address: {
          street: document.getElementById('address').value.trim(),
          city: document.getElementById('city').value.trim(),
          state: document.getElementById('state').value,
        },
        notes: document.getElementById('notes').value.trim(),
        paymentMethod: selectedPaymentMethod,
        items: cart,
        subtotal: calculateSubtotal(),
        shipping: calculateShipping(),
        total: calculateTotal(),
        status: 'pending',
        createdAt: new Date().toISOString()
      };

      console.log('Order data:', orderData);

      // Process payment based on method
      processPayment(orderData, btn);
    }

    // Process payment
    function processPayment(orderData, btn) {
      console.log('Processing payment for method:', orderData.paymentMethod);
      
      // Simulate payment processing delay
      setTimeout(() => {
        switch(orderData.paymentMethod) {
          case 'card':
            processCardPayment(orderData, btn);
            break;
          case 'bank':
            processBankTransfer(orderData, btn);
            break;
          case 'delivery':
            processCashOnDelivery(orderData, btn);
            break;
          default:
            showNotification('Invalid payment method', 'error');
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-check-circle"></i> Place Order';
        }
      }, 1000);
    }

    // Process Card Payment
    function processCardPayment(orderData, btn) {
      console.log('Processing card payment');
      
      // In production, this would integrate with Paystack, Flutterwave, or Stripe
      // For now, simulate successful payment
      
      btn.innerHTML = '<span class="spinner"></span> Verifying Card...';
      
      setTimeout(() => {
        // Simulate 80% success rate
        const paymentSuccess = Math.random() > 0.2;
        
        if (paymentSuccess) {
          orderData.paymentStatus = 'paid';
          orderData.status = 'processing';
          orderData.transactionId = 'TXN' + Date.now();
          
          completeOrder(orderData);
        } else {
          showNotification('Card payment failed. Please try again or use another method.', 'error');
          btn.disabled = false;
          btn.innerHTML = '<i class="fas fa-check-circle"></i> Place Order';
        }
      }, 2000);
    }

    // Process Bank Transfer
    function processBankTransfer(orderData, btn) {
      console.log('Processing bank transfer');
      
      orderData.paymentStatus = 'pending';
      orderData.bankDetails = {
        bankName: 'Gadrel Collection Bank',
        accountNumber: '1234567890',
        accountName: 'Gadrel Collection Ltd'
      };
      
      completeOrder(orderData);
    }

    // Process Cash on Delivery
    function processCashOnDelivery(orderData, btn) {
      console.log('Processing cash on delivery');
      
      orderData.paymentStatus = 'pending';
      orderData.status = 'pending';
      
      completeOrder(orderData);
    }

    // Complete order
    function completeOrder(orderData) {
      console.log('Completing order:', orderData);
      
      try {
        // Save order
        let orders = JSON.parse(localStorage.getItem('gadrelOrders')) || [];
        orders.push(orderData);
        localStorage.setItem('gadrelOrders', JSON.stringify(orders));
        console.log('Order saved to localStorage');

        // Update user order count
        if (currentUser) {
          currentUser.orderCount = (currentUser.orderCount || 0) + 1;
          localStorage.setItem('gadrelCurrentUser', JSON.stringify(currentUser));

          // Update users array
          let users = JSON.parse(localStorage.getItem('gadrelUsers')) || [];
          const userIndex = users.findIndex(u => u.id === currentUser.id);
          if (userIndex !== -1) {
            users[userIndex] = currentUser;
            localStorage.setItem('gadrelUsers', JSON.stringify(users));
          }
          console.log('User data updated');
        }

        // Update product stock
        const products = JSON.parse(localStorage.getItem('gadrelProducts')) || [];
        cart.forEach(cartItem => {
          const product = products.find(p => p.id === cartItem.id);
          if (product) {
            product.stock = Math.max(0, product.stock - cartItem.quantity);
          }
        });
        localStorage.setItem('gadrelProducts', JSON.stringify(products));
        console.log('Product stock updated');

        // Create notification
        const notifications = JSON.parse(localStorage.getItem('gadrelNotifications')) || [];
        notifications.push({
          id: Date.now(),
          userId: currentUser.id,
          title: 'Order Placed Successfully',
          message: `Your order #${orderData.id} has been placed and is being processed.`,
          type: 'success',
          icon: 'shopping-bag',
          read: false,
          createdAt: new Date().toISOString()
        });
        localStorage.setItem('gadrelNotifications', JSON.stringify(notifications));
        console.log('Notification created');

        // Clear cart
        localStorage.removeItem('gadrelCart');
        console.log('Cart cleared');

        // Show success message
        showNotification('Order placed successfully! Redirecting...', 'success');

        // Redirect to order confirmation
        setTimeout(() => {
          window.location.href = `order-confirmation.html?orderId=${orderData.id}`;
        }, 2000);
      } catch (error) {
        console.error('Error completing order:', error);
        showNotification('Error placing order. Please try again.', 'error');
        const btn = document.querySelector('.btn-place-order');
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-check-circle"></i> Place Order';
      }
    }

    // Notification system
    function showNotification(message, type = 'success') {
      const colors = {
        success: 'linear-gradient(135deg, #4CAF50, #45a049)',
        error: 'linear-gradient(135deg, #e74c3c, #c0392b)',
        warning: 'linear-gradient(135deg, #f39c12, #e67e22)',
        info: 'linear-gradient(135deg, #3498db, #2980b9)'
      };

      const icons = {
        success: 'fa-check-circle',
        error: 'fa-times-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
      };

      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: ${colors[type]};
        color: white;
        padding: 18px 30px;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        z-index: 9999;
        animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        max-width: 350px;
        font-size: 0.95rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 12px;
      `;
      notification.innerHTML = `<i class="fas ${icons[type]}" style="font-size: 1.3rem;"></i> <span>${message}</span>`;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
        setTimeout(() => notification.remove(), 400);
      }, 3000);
    }

    // Add animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  </script>

</body>
</html>